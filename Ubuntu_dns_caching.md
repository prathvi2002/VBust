Maybe Ubuntu machines create DNS caches by default (not sure about this behaviour at all!).

## So here is a commond to Clear DNS cache maintained by systemd-resolved, forcing fresh lookups for future DNS queries in ubuntu
`sudo resolvectl flush-caches`

---
## Disable DNS caching on Ubuntu (given by Copilot, didn't verify if it works and didn't verify the check if caching is disabled info too)
To disable DNS caching on Ubuntu, you’ll first need to identify which caching service is active - typically `systemd-resolved` on modern Ubuntu systems. Here’s how to disable it step by step:
### Disable DNS Cache via (when using `systemd-resolved`)
1. Edit the config file:
`sudo vim /etc/systemd/resolved.conf`
2. Modify or add this line under the `[Resolve]` section:
`Cache=no`
`CacheFromLocalhost=no`
3. Save and exit.
4. Restart the service:
`sudo systemctl restart systemd-resolved`

### Verify DNS caching is disabled
You can use dig to check TTL values:
```
dig example.com
sleep 2
dig example.com
```
If the TTL doesn’t decrease, caching is likely disabled. (Note from me Prathvi: Or is it, If the TTL decreases between calls, your system isn't caching.)


The TTL (Time To Live) value is the number just before the IN in each answer line of the ANSWER SECTION in the `dig` output:
```
example.com.            255     IN      A       23.192.228.80
```

The 255 is the TTL, in seconds.
So, in this case, each of the A records for example.com has a TTL of 255 seconds. That means a DNS resolver can cache this record for 255 seconds before re-querying it.

---

`sudo resolvectl statistics`
`sudo resolvectl show-cache`


---

# Dump

## I asked: ```how to check if my machine is using systemd-resolved```

Copilot response:

To check if your Ubuntu machine is using systemd-resolved for DNS resolution, here are a few reliable methods:

🧪 1. Check the service status
Run:
`systemctl is-active systemd-resolved`


- If it returns active, the service is running.
- You can also check if it's enabled at boot:
systemctl is-enabled systemd-resolved


📄 2. Inspect `/etc/resolv.conf`
Run:
`cat /etc/resolv.conf`

If you see this line at the top:
```This file is managed by systemd-resolved...```

Then your system is using systemd-resolved as the DNS stub resolver.

🧭 3. Use resolvectl
Run:
`resolvectl status`

If it returns DNS configuration and shows a DNS server (like `127.0.0.53` or a custom IP), then systemd-resolved is active and managing DNS.


## I gave it this out of my terminal:
```
VBust on  main [?] via  v3.12.3 ❯ systemctl is-active systemd-resolved 
active
VBust on  main [?] via  v3.12.3 ❯ systemctl is-enabled systemd-resolved 
enabled
VBust on  main [?] via  v3.12.3 ❯ cat /etc/resolv.conf
This file was automatically generated by WSL. To stop automatic generation of this file, add the following entry to /etc/wsl.conf:
[network]
generateResolvConf = false
nameserver 10.255.255.254 search domain.name
VBust on  main [?] via  v3.12.3 ❯ resolvectl status Global Protocols: -LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported resolv.conf mode: foreign Current DNS Server: 10.255.255.254 DNS Servers: 10.255.255.254 DNS Domain: domain.name
Link 2 (eth0) Current Scopes: none Protocols: -DefaultRoute -LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported
Link 3 (loopback0) Current Scopes: none Protocols: -DefaultRoute -LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported
Link 4 (eth1) Current Scopes: none Protocols: -DefaultRoute -LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported
Link 5 (eth2) Current Scopes: none Protocols: -DefaultRoute -LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported
Link 6 (eth3) Current Scopes: none Protocols: -DefaultRoute -LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported
```

Copilot response:

Thanks for sharing that, Prathvi. Based on the output, here’s the situation in plain terms:

✅ Is your system using systemd-resolved?

Yes.
You confirmed it’s both active and enabled

```
systemctl is-active systemd-resolved   → active  
systemctl is-enabled systemd-resolved → enabled
```

⚠️ But is it actually handling DNS resolution

Not directly.
Your `/etc/resolv.conf` says:

```
# This file was automatically generated by WSL...
nameserver 10.255.255.254
```

That means WSL (Windows Subsystem for Linux) is overriding the DNS settings and pointing them to a Windows-managed DNS server (`10.255.255.254`). The line `resolv.conf mode: foreign` in `resolvectl` status confirms that `systemd-resolved` is not controlling name resolution right now.

🧠 Translation

- `systemd-resolved` is running, but not managing DNS—your DNS is being handled through WSL's integration with Windows.
- Any settings in `/etc/systemd/resolved.conf` like `Cache=no` will have no effect unless you change WSL's behavior.

💡 Want to fully control DNS inside WSL

You can stop automatic `resolv.conf` generation by doing this:
1. Edit WSL config:
```
sudo mkdir -p /etc
echo -e "[network]\ngenerateResolvConf = false" | sudo tee /etc/wsl.conf
```
2. Restart WSL (or your PC), then manually set `/etc/resolv.conf` to use your preferred nameserver, e.g.:
`sudo bash -c 'echo "nameserver 8.8.8.8" > /etc/resolv.conf'`

Let me know if you want systemd-resolved to take full control in WSL or if you’d rather just drop caching altogether and go fully manual.


## I replied: ```i wanna drop caching altogether and go fully manual```
Got it — you're going full precision mode, Prathvi. Here's how to make sure no DNS caching interferes, and your system queries DNS servers fresh every time:
🛑 Step 1: Disable systemd-resolved (if you're not relying on it)
`sudo systemctl disable --now systemd-resolved.service`
This stops and disables the service entirely.

📁 Step 2: Set up a static `/etc/resolv.conf`

1. Remove the current symlink (if it exists):
`sudo rm /etc/resolv.conf`
2. Create a manual DNS config:
`echo "nameserver 8.8.8.8" | sudo tee /etc/resolv.conf`
You can replace `8.8.8.8` with Cloudflare (`1.1.1.1`), Quad9, or your preferred nameserver.

